karabo-attributes:
  SPB_RR_SYS/MDL/BUNCH_PATTERN:
    sase1.charge.value:
      - id: bunch_charge
        input-type: List[float]
        processor: list-arithmetic-mean
        unit: nC
    sase1.nPulses.value:
      id: number_of_bunches
      input-type: int
  SPB_XTD9_XGM/XGM/DOOCS:
    pulseEnergy.wavelengthUsed.value:
      id: wavelength
      input-type: float
      unit: nm
  SPB_XTD9_XGM/XGM/DOOCS:output:
    data.intensitySa1TD:
      id: pulse_energy
      input-type: List[float]
      processor: list-take-last
      unit: mJ
      ignore: 1.0

    data.xSa1TD:
      - id: beam_x
        input-type: List[float]
        processor: list-arithmetic-mean
        unit: mm
        ignore: 1.0

      - id: beam_x_stdev
        input-type: List[float]
        processor: list-standard-deviation
        unit: mm
        ignore: 1.0

    data.ySa1TD:
      - id: beam_y
        input-type: List[float]
        processor: list-arithmetic-mean
        unit: mm
        ignore: 1.0

      - id: beam_y_stdev
        input-type: List[float]
        processor: list-standard-deviation
        unit: mm
        ignore: 1.0


  SPB_IRU_AGIPD1M1/MDL/FPGA_COMP:
    gainMode.value:
      id: gain_mode
      input-type: str
    gain.value:
      id: gain
      input-type: int
  SPB_IRU_AGIPD1M/MOTOR/Z_STEPPER:
    actualPosition.value:
      id: detector_distance
      input-type: float
      unit: mm
  SA1_XTD2_ATT/MDL/MAIN:
    actual.value.transmission:
      id: xtd2_transmission
      input-type: float
      is-si-unit: false
  SPB_XTD9_ATT/MDL/MAIN:
    actual.value.transmission:
      id: xtd9_transmission
      input-type: float
      is-si-unit: false
  SPB_BIO_SYS/PUMP/HPLC:
    a.flow.value:
      id: pump_a_flow
      input-type: float
      unit: ul/min
    b.flow.value:
      id: pump_b_flow
      input-type: float
      unit: ul/min
    c.flow.value:
      id: pump_c_flow
      input-type: float
      unit: ul/min
    d.flow.value:
      id: pump_d_flow
      input-type: float
      unit: ul/min
  SPB_IRU_INJMOV/MOTOR/Z:
    actualPosition.value:
      id: injector_position_z
      unit: mm
      input-type: float


special-karabo-attributes:
  runNumber:
    source: SPB_DAQ_DATA/DM/RUN_CONTROL
    key: runNumber.value
  runStartedAt:
    source: SPB_DAQ_DATA/DM/RUN_CONTROL
    key: runDetails.beginAt.value
  runFirstTrain:
    source: SPB_DAQ_DATA/DM/RUN_CONTROL
    key: runDetails.firstTrainId.value
  runTrainsInRun:
    source: SPB_DAQ_DATA/DM/RUN_CONTROL
    key: runDetails.length.value
  proposalId:
    source: SPB_DAQ_DATA/DM/RUN_CONTROL
    key: proposalNumber.value
  darkRunIndex:
    source: SPB_DA_USR/MDL/AMARCORD_INFO
    key: darkRunNumber.value
  darkRunType:
    source: SPB_DA_USR/MDL/AMARCORD_INFO
    key: darkExperiment.value



amarcord-attributi:
  injector_position_z:
    plain-attribute: injector_position_z
    processor: arithmetic-mean
  xtd9_transmission:
    plain-attribute: xtd9_transmission
    processor: arithmetic-mean
  xtd2_transmission:
    plain-attribute: xtd2_transmission
    processor: arithmetic-mean
  flow_values:
    coagulate: [pump_a_flow, pump_b_flow, pump_c_flow, pump_d_flow]
    processor: arithmetic-mean
  detector_distance:
    plain-attribute: detector_distance
    processor: arithmetic-mean
  bunch_charge:
    plain-attribute: bunch_charge
    processor: arithmetic-mean
  number_of_bunches:
    plain-attribute: number_of_bunches
    processor: take-last
  wavelength:
    plain-attribute: wavelength
    processor: arithmetic-mean
  pulse_energy:
    plain-attribute: pulse_energy
    processor: arithmetic-mean
  beam_position_avg:
    coagulate: [ beam_x, beam_y ]
    processor: arithmetic-mean
  beam_position_propagated_stdev:
    coagulate: [ beam_x_stdev, beam_y_stdev ]
    processor: propagated-standard-deviation
    description: "The beam position stdev"
  gain_mode:
    plain-attribute: gain_mode
    processor: take-last
  gain:
    plain-attribute: gain
    processor: take-last

proposal-id: 2770
